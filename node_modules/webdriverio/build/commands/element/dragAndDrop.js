"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const constants_1 = require("../../constants");
const ACTION_BUTTON = 0;
const sleep = (time = 0) => new Promise((resolve) => setTimeout(resolve, time));
/**
 *
 * Drag an item to a destination element or position.
 *
 * :::info
 *
 * The functionality of this command highly depends on the way drag and drop is
 * implemented in your app. If you experience issues please post your example
 * in [#4134](https://github.com/webdriverio/webdriverio/issues/4134).
 *
 * :::
 *
 * <example>
    :example.test.js
    it('should demonstrate the dragAndDrop command', () => {
        const elem = $('#someElem')
        const target = $('#someTarget')

        // drag and drop to other element
        elem.dragAndDrop(target)

        // drag and drop relative from current position
        elem.dragAndDrop({ x: 100, y: 200 })
    })
 * </example>
 *
 * @alias element.dragAndDrop
 * @param {Element|DragAndDropCoordinate} target  destination element or object with x and y properties
 * @param {DragAndDropOptions=} options           dragAndDrop command options
 * @param {Number=}             options.duration  how long the drag should take place
 */
async function dragAndDrop(target, { duration = 10 } = {}) {
    const moveToCoordinates = target;
    const moveToElement = target;
    /**
     * fail if
     */
    if (
    /**
     * no target was specified
     */
    !target ||
        (
        /**
         * target is not from type element
         */
        target.constructor.name !== 'Element' &&
            /**
             * and is also not an object with x and y number parameters
             */
            (typeof moveToCoordinates.x !== 'number' ||
                typeof moveToCoordinates.y !== 'number'))) {
        throw new Error('command dragAndDrop requires an WebdriverIO Element or and object with "x" and "y" variables as first parameter');
    }
    /**
     * allow to specify an element or an x/y vector
     */
    const isMovingToElement = target.constructor.name === 'Element';
    if (!this.isW3C) {
        await this.moveTo();
        await this.buttonDown(ACTION_BUTTON);
        if (isMovingToElement) {
            await moveToElement.moveTo();
        }
        else {
            await this.moveToElement(null, moveToCoordinates.x, moveToCoordinates.y);
        }
        await sleep(duration);
        return this.buttonUp(ACTION_BUTTON);
    }
    const sourceRef = { [constants_1.ELEMENT_KEY]: this[constants_1.ELEMENT_KEY] };
    const targetRef = { [constants_1.ELEMENT_KEY]: moveToElement[constants_1.ELEMENT_KEY] };
    const origin = sourceRef;
    const targetOrigin = isMovingToElement ? targetRef : 'pointer';
    const targetX = isMovingToElement ? 0 : moveToCoordinates.x;
    const targetY = isMovingToElement ? 0 : moveToCoordinates.y;
    /**
     * W3C way of handle the drag and drop action
     */
    return this.performActions([{
            type: 'pointer',
            id: 'finger1',
            parameters: { pointerType: 'mouse' },
            actions: [
                { type: 'pointerMove', duration: 0, origin, x: 0, y: 0 },
                { type: 'pointerDown', button: ACTION_BUTTON },
                { type: 'pause', duration: 10 },
                { type: 'pointerMove', duration, origin: targetOrigin, x: targetX, y: targetY },
                { type: 'pointerUp', button: ACTION_BUTTON }
            ]
        }]).then(() => this.releaseActions());
}
exports.default = dragAndDrop;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZHJhZ0FuZERyb3AuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi9zcmMvY29tbWFuZHMvZWxlbWVudC9kcmFnQW5kRHJvcC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLCtDQUE2QztBQUc3QyxNQUFNLGFBQWEsR0FBRyxDQUFDLENBQUE7QUFFdkIsTUFBTSxLQUFLLEdBQUcsQ0FBQyxJQUFJLEdBQUcsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxJQUFJLE9BQU8sQ0FBQyxDQUFDLE9BQU8sRUFBRSxFQUFFLENBQUMsVUFBVSxDQUFDLE9BQU8sRUFBRSxJQUFJLENBQUMsQ0FBQyxDQUFBO0FBVy9FOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7R0E4Qkc7QUFDWSxLQUFLLFVBQVUsV0FBVyxDQUVyQyxNQUFnRCxFQUNoRCxFQUFFLFFBQVEsR0FBRyxFQUFFLEtBQXlCLEVBQUU7SUFFMUMsTUFBTSxpQkFBaUIsR0FBRyxNQUE0QixDQUFBO0lBQ3RELE1BQU0sYUFBYSxHQUFHLE1BQTZCLENBQUE7SUFFbkQ7O09BRUc7SUFDSDtJQUNJOztPQUVHO0lBQ0gsQ0FBQyxNQUFNO1FBQ1A7UUFDSTs7V0FFRztRQUNILE1BQU0sQ0FBQyxXQUFXLENBQUMsSUFBSSxLQUFLLFNBQVM7WUFDckM7O2VBRUc7WUFDSCxDQUNJLE9BQU8saUJBQWlCLENBQUMsQ0FBQyxLQUFLLFFBQVE7Z0JBQ3ZDLE9BQU8saUJBQWlCLENBQUMsQ0FBQyxLQUFLLFFBQVEsQ0FDMUMsQ0FDSixFQUNIO1FBQ0UsTUFBTSxJQUFJLEtBQUssQ0FBQyxpSEFBaUgsQ0FBQyxDQUFBO0tBQ3JJO0lBRUQ7O09BRUc7SUFDSCxNQUFNLGlCQUFpQixHQUFHLE1BQU0sQ0FBQyxXQUFXLENBQUMsSUFBSSxLQUFLLFNBQVMsQ0FBQTtJQUUvRCxJQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssRUFBRTtRQUNiLE1BQU0sSUFBSSxDQUFDLE1BQU0sRUFBRSxDQUFBO1FBQ25CLE1BQU0sSUFBSSxDQUFDLFVBQVUsQ0FBQyxhQUFhLENBQUMsQ0FBQTtRQUVwQyxJQUFJLGlCQUFpQixFQUFFO1lBQ25CLE1BQU0sYUFBYSxDQUFDLE1BQU0sRUFBRSxDQUFBO1NBQy9CO2FBQU07WUFDSCxNQUFNLElBQUksQ0FBQyxhQUFhLENBQUMsSUFBSSxFQUFFLGlCQUFpQixDQUFDLENBQUMsRUFBRSxpQkFBaUIsQ0FBQyxDQUFDLENBQUMsQ0FBQTtTQUMzRTtRQUVELE1BQU0sS0FBSyxDQUFDLFFBQVEsQ0FBQyxDQUFBO1FBQ3JCLE9BQU8sSUFBSSxDQUFDLFFBQVEsQ0FBQyxhQUFhLENBQUMsQ0FBQTtLQUN0QztJQUVELE1BQU0sU0FBUyxHQUFxQixFQUFFLENBQUMsdUJBQVcsQ0FBQyxFQUFFLElBQUksQ0FBQyx1QkFBVyxDQUFDLEVBQUUsQ0FBQTtJQUN4RSxNQUFNLFNBQVMsR0FBcUIsRUFBRSxDQUFDLHVCQUFXLENBQUMsRUFBRSxhQUFhLENBQUMsdUJBQVcsQ0FBQyxFQUFFLENBQUE7SUFFakYsTUFBTSxNQUFNLEdBQUcsU0FBUyxDQUFBO0lBQ3hCLE1BQU0sWUFBWSxHQUFHLGlCQUFpQixDQUFDLENBQUMsQ0FBQyxTQUFTLENBQUMsQ0FBQyxDQUFDLFNBQVMsQ0FBQTtJQUU5RCxNQUFNLE9BQU8sR0FBRyxpQkFBaUIsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxpQkFBaUIsQ0FBQyxDQUFDLENBQUE7SUFDM0QsTUFBTSxPQUFPLEdBQUcsaUJBQWlCLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsaUJBQWlCLENBQUMsQ0FBQyxDQUFBO0lBRTNEOztPQUVHO0lBQ0gsT0FBTyxJQUFJLENBQUMsY0FBYyxDQUFDLENBQUM7WUFDeEIsSUFBSSxFQUFFLFNBQVM7WUFDZixFQUFFLEVBQUUsU0FBUztZQUNiLFVBQVUsRUFBRSxFQUFFLFdBQVcsRUFBRSxPQUFPLEVBQUU7WUFDcEMsT0FBTyxFQUFFO2dCQUNMLEVBQUUsSUFBSSxFQUFFLGFBQWEsRUFBRSxRQUFRLEVBQUUsQ0FBQyxFQUFFLE1BQU0sRUFBRSxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUU7Z0JBQ3hELEVBQUUsSUFBSSxFQUFFLGFBQWEsRUFBRSxNQUFNLEVBQUUsYUFBYSxFQUFFO2dCQUM5QyxFQUFFLElBQUksRUFBRSxPQUFPLEVBQUUsUUFBUSxFQUFFLEVBQUUsRUFBRTtnQkFDL0IsRUFBRSxJQUFJLEVBQUUsYUFBYSxFQUFFLFFBQVEsRUFBRSxNQUFNLEVBQUUsWUFBWSxFQUFFLENBQUMsRUFBRSxPQUFPLEVBQUUsQ0FBQyxFQUFFLE9BQU8sRUFBRTtnQkFDL0UsRUFBRSxJQUFJLEVBQUUsV0FBVyxFQUFFLE1BQU0sRUFBRSxhQUFhLEVBQUU7YUFDL0M7U0FDSixDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsR0FBRyxFQUFFLENBQUMsSUFBSSxDQUFDLGNBQWMsRUFBRSxDQUFDLENBQUE7QUFDekMsQ0FBQztBQTVFRCw4QkE0RUMifQ==