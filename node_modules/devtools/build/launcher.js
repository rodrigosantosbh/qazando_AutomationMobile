"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const chrome_launcher_1 = require("chrome-launcher");
const puppeteer_core_1 = __importDefault(require("puppeteer-core"));
const logger_1 = __importDefault(require("@wdio/logger"));
const finder_1 = __importDefault(require("./finder"));
const utils_1 = require("./utils");
const constants_1 = require("./constants");
const log = logger_1.default('devtools');
const DEVICE_NAMES = Object.values(puppeteer_core_1.default.devices).map((device) => device.name);
/**
 * launches Chrome and returns a Puppeteer browser instance
 * @param  {object} capabilities  session capabilities
 * @return {object}               puppeteer browser instance
 */
async function launchChrome(capabilities) {
    const chromeOptions = capabilities[constants_1.VENDOR_PREFIX.chrome] || {};
    const mobileEmulation = chromeOptions.mobileEmulation || {};
    const devtoolsOptions = capabilities['wdio:devtoolsOptions'];
    /**
     * `ignoreDefaultArgs` and `headless` are currently expected to be part of the capabilities
     * but we should move them into a custom capability object, e.g. `wdio:devtoolsOptions`.
     * This should be cleaned up for v7 release
     * ToDo(Christian): v7 cleanup
     */
    let ignoreDefaultArgs = capabilities.ignoreDefaultArgs;
    let debuggerAddress = chromeOptions.debuggerAddress;
    let port;
    if (debuggerAddress) {
        const requestedPort = debuggerAddress.split(':')[1];
        port = parseInt(requestedPort, 10);
    }
    let headless = chromeOptions.headless;
    if (devtoolsOptions) {
        ignoreDefaultArgs = devtoolsOptions.ignoreDefaultArgs;
        headless = devtoolsOptions.headless;
    }
    if (typeof mobileEmulation.deviceName === 'string') {
        const deviceProperties = Object.values(puppeteer_core_1.default.devices).find(device => device.name === mobileEmulation.deviceName);
        if (!deviceProperties) {
            throw new Error(`Unknown device name "${mobileEmulation.deviceName}", available: ${DEVICE_NAMES.join(', ')}`);
        }
        mobileEmulation.userAgent = deviceProperties.userAgent;
        mobileEmulation.deviceMetrics = {
            width: deviceProperties.viewport.width,
            height: deviceProperties.viewport.height,
            pixelRatio: deviceProperties.viewport.deviceScaleFactor
        };
    }
    const defaultFlags = Array.isArray(ignoreDefaultArgs) ? constants_1.DEFAULT_FLAGS.filter(flag => !ignoreDefaultArgs.includes(flag)) : (!ignoreDefaultArgs) ? constants_1.DEFAULT_FLAGS : [];
    const deviceMetrics = mobileEmulation.deviceMetrics || {};
    const chromeFlags = [
        ...defaultFlags,
        ...[
            `--window-position=${constants_1.DEFAULT_X_POSITION},${constants_1.DEFAULT_Y_POSITION}`,
            `--window-size=${constants_1.DEFAULT_WIDTH},${constants_1.DEFAULT_HEIGHT}`
        ],
        ...(headless ? [
            '--headless',
            '--no-sandbox'
        ] : []),
        ...(chromeOptions.args || [])
    ];
    if (typeof deviceMetrics.pixelRatio === 'number') {
        chromeFlags.push(`--device-scale-factor=${deviceMetrics.pixelRatio}`);
    }
    if (typeof mobileEmulation.userAgent === 'string') {
        chromeFlags.push(`--user-agent=${mobileEmulation.userAgent}`);
    }
    if (port) {
        log.info(`Requesting to connect to Google Chrome on port: ${port}`);
    }
    log.info(`Launch Google Chrome with flags: ${chromeFlags.join(' ')}`);
    const chrome = await chrome_launcher_1.launch({
        chromePath: chromeOptions.binary,
        ignoreDefaultFlags: true,
        chromeFlags,
        ...(port ? { port } : {})
    });
    log.info(`Connect Puppeteer with browser on port ${chrome.port}`);
    const browser = await puppeteer_core_1.default.connect({
        ...chromeOptions,
        browserURL: `http://localhost:${chrome.port}`,
        // @ts-ignore ToDo(@L0tso): remove once https://github.com/puppeteer/puppeteer/pull/6942 is merged
        defaultViewport: null
    }); // casting from @types/puppeteer to built in type
    /**
     * when using Chrome Launcher we have to close a tab as Puppeteer
     * creates automatically a new one
     */
    const pages = await utils_1.getPages(browser);
    for (const page of pages.slice(0, -1)) {
        if (page.url() === 'about:blank') {
            await page.close();
        }
    }
    if (deviceMetrics.width && deviceMetrics.height) {
        await pages[0].setViewport(deviceMetrics);
    }
    return browser;
}
function launchBrowser(capabilities, browserType) {
    var _a;
    const product = browserType === constants_1.BROWSER_TYPE.firefox ? constants_1.BROWSER_TYPE.firefox : constants_1.BROWSER_TYPE.chrome;
    const vendorCapKey = constants_1.VENDOR_PREFIX[browserType];
    const devtoolsOptions = capabilities['wdio:devtoolsOptions'];
    /**
     * `ignoreDefaultArgs` and `headless` are currently expected to be part of the capabilities
     * but we should move them into a custom capability object, e.g. `wdio:devtoolsOptions`.
     * This should be cleaned up for v7 release
     * ToDo(Christian): v7 cleanup
     */
    let ignoreDefaultArgs = capabilities.ignoreDefaultArgs;
    let headless = capabilities.headless;
    if (devtoolsOptions) {
        ignoreDefaultArgs = devtoolsOptions.ignoreDefaultArgs;
        headless = devtoolsOptions.headless;
    }
    if (!capabilities[vendorCapKey]) {
        capabilities[vendorCapKey] = {};
    }
    const browserFinderMethod = finder_1.default(browserType, process.platform);
    const executablePath = (((_a = capabilities[vendorCapKey]) === null || _a === void 0 ? void 0 : _a.binary) ||
        browserFinderMethod()[0]);
    const puppeteerOptions = Object.assign({
        product,
        executablePath,
        ignoreDefaultArgs,
        headless: Boolean(headless),
        defaultViewport: {
            width: constants_1.DEFAULT_WIDTH,
            height: constants_1.DEFAULT_HEIGHT
        }
    }, capabilities[vendorCapKey] || {}, devtoolsOptions || {});
    if (!executablePath) {
        throw new Error('Couldn\'t find executable for browser');
    }
    else if (browserType === constants_1.BROWSER_TYPE.firefox &&
        executablePath !== 'firefox' &&
        !executablePath.toLowerCase().includes(constants_1.CHANNEL_FIREFOX_NIGHTLY) &&
        !executablePath.toLowerCase().includes(constants_1.CHANNEL_FIREFOX_TRUNK)) {
        throw new Error(constants_1.BROWSER_ERROR_MESSAGES.firefoxNightly);
    }
    log.info(`Launch ${executablePath} with config: ${JSON.stringify(puppeteerOptions)}`);
    return puppeteer_core_1.default.launch(puppeteerOptions);
}
function connectBrowser(browserURL) {
    return puppeteer_core_1.default.connect({ browserURL });
}
function launch(capabilities) {
    var _a, _b;
    const browserName = (_a = capabilities.browserName) === null || _a === void 0 ? void 0 : _a.toLowerCase();
    /**
     * check if capabilities already contains connection details and connect
     * to that rather than starting a new browser
     */
    const browserOptions = capabilities['goog:chromeOptions'] || capabilities['ms:edgeOptions'];
    if ((browserOptions === null || browserOptions === void 0 ? void 0 : browserOptions.debuggerAddress) && !((_b = capabilities['wdio:devtoolsOptions']) === null || _b === void 0 ? void 0 : _b.customDebuggerAddress)) {
        return connectBrowser(`http://${browserOptions === null || browserOptions === void 0 ? void 0 : browserOptions.debuggerAddress}`);
    }
    if (browserName && constants_1.CHROME_NAMES.includes(browserName)) {
        return launchChrome(capabilities);
    }
    if (browserName && constants_1.FIREFOX_NAMES.includes(browserName)) {
        return launchBrowser(capabilities, constants_1.BROWSER_TYPE.firefox);
    }
    /* istanbul ignore next */
    if (browserName && constants_1.EDGE_NAMES.includes(browserName)) {
        return launchBrowser(capabilities, constants_1.BROWSER_TYPE.edge);
    }
    throw new Error(`Couldn't identify browserName "${browserName}"`);
}
exports.default = launch;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibGF1bmNoZXIuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi9zcmMvbGF1bmNoZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFBQSxxREFBK0Q7QUFDL0Qsb0VBQXNDO0FBQ3RDLDBEQUFpQztBQUlqQyxzREFBb0M7QUFDcEMsbUNBQWtDO0FBQ2xDLDJDQWNvQjtBQUdwQixNQUFNLEdBQUcsR0FBRyxnQkFBTSxDQUFDLFVBQVUsQ0FBQyxDQUFBO0FBRTlCLE1BQU0sWUFBWSxHQUFHLE1BQU0sQ0FBQyxNQUFNLENBQUMsd0JBQVMsQ0FBQyxPQUFPLENBQUMsQ0FBQyxHQUFHLENBQUMsQ0FBQyxNQUFNLEVBQUUsRUFBRSxDQUFDLE1BQU0sQ0FBQyxJQUFJLENBQUMsQ0FBQTtBQUVsRjs7OztHQUlHO0FBQ0gsS0FBSyxVQUFVLFlBQVksQ0FBRSxZQUFrQztJQUMzRCxNQUFNLGFBQWEsR0FBK0IsWUFBWSxDQUFDLHlCQUFhLENBQUMsTUFBTSxDQUFDLElBQUksRUFBRSxDQUFBO0lBQzFGLE1BQU0sZUFBZSxHQUFHLGFBQWEsQ0FBQyxlQUFlLElBQUksRUFBRSxDQUFBO0lBQzNELE1BQU0sZUFBZSxHQUFHLFlBQVksQ0FBQyxzQkFBc0IsQ0FBQyxDQUFBO0lBRTVEOzs7OztPQUtHO0lBQ0gsSUFBSSxpQkFBaUIsR0FBSSxZQUFvQixDQUFDLGlCQUFpQixDQUFBO0lBRS9ELElBQUksZUFBZSxHQUFHLGFBQWEsQ0FBQyxlQUFlLENBQUE7SUFDbkQsSUFBSSxJQUFJLENBQUE7SUFDUixJQUFJLGVBQWUsRUFBRTtRQUNqQixNQUFNLGFBQWEsR0FBRyxlQUFlLENBQUMsS0FBSyxDQUFDLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFBO1FBQ25ELElBQUksR0FBRyxRQUFRLENBQUMsYUFBYSxFQUFFLEVBQUUsQ0FBQyxDQUFBO0tBQ3JDO0lBRUQsSUFBSSxRQUFRLEdBQUksYUFBcUIsQ0FBQyxRQUFRLENBQUE7SUFFOUMsSUFBSSxlQUFl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